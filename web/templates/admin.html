<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–≤—Ç–æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 24px;
        }
        .nav-links {
            display: flex;
            gap: 15px;
        }
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            transition: background 0.3s;
        }
        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .filters input,
        .filters select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        .filters button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-CREATED {
            background: #d4edda;
            color: #155724;
        }
        .status-UPDATED {
            background: #d1ecf1;
            color: #0c5460;
        }
        .status-DELETED {
            background: #f8d7da;
            color: #721c24;
        }
        .status-NOT_PROCESSED {
            background: #fff3cd;
            color: #856404;
        }
        .btn-edit {
            padding: 6px 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .pagination {
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .pagination a,
        .pagination span {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            text-decoration: none;
            color: #333;
        }
        .pagination .active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .close {
            cursor: pointer;
            font-size: 24px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }
        .form-group textarea {
            min-height: 100px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöó –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞–≤—Ç–æ</h1>
        <div class="nav-links">
            <a href="/">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="/admin">–ê–¥–º—ñ–Ω</a>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card">
            <h3>–í—Å—å–æ–≥–æ –∞–≤—Ç–æ</h3>
            <div class="value">{{ stats.total }}</div>
        </div>
        {% for status, count in stats.by_status.items() %}
        <div class="stat-card">
            <h3>{{ status }}</h3>
            <div class="value">{{ count }}</div>
        </div>
        {% endfor %}
    </div>

    <div class="filters">
        <input type="text" id="search" placeholder="–ü–æ—à—É–∫ (–º–∞—Ä–∫–∞, –æ–ø–∏—Å, –ª—ñ–Ω–∫)" value="{{ search or '' }}">
        <select id="status">
            <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
            <option value="CREATED" {% if status == 'CREATED' %}selected{% endif %}>CREATED</option>
            <option value="UPDATED" {% if status == 'UPDATED' %}selected{% endif %}>UPDATED</option>
            <option value="DELETED" {% if status == 'DELETED' %}selected{% endif %}>DELETED</option>
            <option value="NOT_PROCESSED" {% if status == 'NOT_PROCESSED' %}selected{% endif %}>NOT_PROCESSED</option>
        </select>
        <button onclick="applyFilters()">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
        <button onclick="resetFilters()">–°–∫–∏–Ω—É—Ç–∏</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ú–∞—Ä–∫–∞</th>
                    <th>–†—ñ–∫</th>
                    <th>–¶—ñ–Ω–∞</th>
                    <th>–ü—Ä–æ–±—ñ–≥</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</th>
                    <th>–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody>
                {% for car in cars %}
                <tr>
                    <td>{{ car.id }}</td>
                    <td>{{ car.brand }}</td>
                    <td>{{ car.year }}</td>
                    <td>{{ "{:,}".format(car.price) }} $</td>
                    <td>{{ "{:,}".format(car.mileage) }} –∫–º</td>
                    <td>
                        <span class="status-badge status-{{ car.processed_status.value if car.processed_status else 'NOT_PROCESSED' }}">
                            {{ car.processed_status.value if car.processed_status else 'NOT_PROCESSED' }}
                        </span>
                    </td>
                    <td>
                        {% if car.is_published %}
                            ‚úÖ
                        {% else %}
                            ‚ùå
                        {% endif %}
                    </td>
                    <td>{{ car.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td>
                        <button class="btn-edit" onclick="editCar({{ car.id }})">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if pages > 1 %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}{% if status %}&status={{ status }}{% endif %}{% if search %}&search={{ search }}{% endif %}">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è</a>
        {% endif %}
        <span class="active">{{ page }} / {{ pages }}</span>
        {% if page < pages %}
        <a href="?page={{ page + 1 }}{% if status %}&status={{ status }}{% endif %}{% if search %}&search={{ search }}{% endif %}">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}

    <!-- Modal –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∞–≤—Ç–æ</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="editForm" onsubmit="saveCar(event)">
                <input type="hidden" id="car_id" name="car_id">
                <div class="form-group">
                    <label>–ú–∞—Ä–∫–∞:</label>
                    <input type="text" id="brand" name="brand" required>
                </div>
                <div class="form-group">
                    <label>–†—ñ–∫:</label>
                    <input type="number" id="year" name="year" required>
                </div>
                <div class="form-group">
                    <label>–¶—ñ–Ω–∞ ($):</label>
                    <input type="number" id="price" name="price" required>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–æ–±—ñ–≥ (–∫–º):</label>
                    <input type="number" id="mileage" name="mileage" required>
                </div>
                <div class="form-group">
                    <label>–¢–∏–ø –ø–∞–ª–∏–≤–∞:</label>
                    <input type="text" id="fuel_type" name="fuel_type" required>
                </div>
                <div class="form-group">
                    <label>–ö–æ—Ä–æ–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á:</label>
                    <input type="text" id="transmission" name="transmission" required>
                </div>
                <div class="form-group">
                    <label>–ö–æ–ª—ñ—Ä:</label>
                    <input type="text" id="color" name="color">
                </div>
                <div class="form-group">
                    <label>–õ–æ–∫–∞—Ü—ñ—è:</label>
                    <input type="text" id="location" name="location">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å:</label>
                    <textarea id="description" name="description" required></textarea>
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞—Ç—É—Å:</label>
                    <select id="processed_status" name="processed_status">
                        <option value="CREATED">CREATED</option>
                        <option value="UPDATED">UPDATED</option>
                        <option value="DELETED">DELETED</option>
                        <option value="NOT_PROCESSED">NOT_PROCESSED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="is_published" name="is_published"> –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ
                    </label>
                </div>
                <button type="submit" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </form>
        </div>
    </div>

    <script>
        function applyFilters() {
            const search = document.getElementById('search').value;
            const status = document.getElementById('status').value;
            let url = '/admin?';
            if (status) url += 'status=' + status + '&';
            if (search) url += 'search=' + encodeURIComponent(search);
            window.location.href = url;
        }

        function resetFilters() {
            window.location.href = '/admin';
        }

        async function editCar(carId) {
            const response = await fetch(`/admin/car/${carId}`);
            const car = await response.json();
            
            document.getElementById('car_id').value = car.id;
            document.getElementById('brand').value = car.brand;
            document.getElementById('year').value = car.year;
            document.getElementById('price').value = car.price;
            document.getElementById('mileage').value = car.mileage;
            document.getElementById('fuel_type').value = car.fuel_type;
            document.getElementById('transmission').value = car.transmission;
            document.getElementById('color').value = car.color || '';
            document.getElementById('location').value = car.location || '';
            document.getElementById('description').value = car.description;
            document.getElementById('processed_status').value = car.processed_status || 'NOT_PROCESSED';
            document.getElementById('is_published').checked = car.is_published;
            
            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        async function saveCar(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            const response = await fetch(`/admin/car/${data.car_id}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                alert('–ê–≤—Ç–æ —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
                location.reload();
            } else {
                alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –∞–≤—Ç–æ');
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>

